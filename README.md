# VPT 初诊数据收集系统

医学研究数据采集微信小程序，用于收集患者临床数据并导出为 CSV 格式进行统计分析。

## 项目简介

本项目是一个专业的医学研究数据收集工具，适用于临床医生在诊疗过程中实时采集患者数据。数据基于微信云开发存储，支持多种数据类型录入，并可将数据导出为 CSV 格式用于 SPSS、R、Python 等统计分析软件。

## 主要功能

### 已实现功能

- ✅ **患者管理**：录入患者基本信息（姓名、性别、年龄、联系方式等）
- ✅ **多阶段数据采集**：
  - 术前检查数据
  - 术中数据
  - 术后回访数据
- ✅ **图片上传**：支持拍照上传术中照片等影像资料
- ✅ **数据导出**：导出 CSV 格式数据，兼容主流统计分析软件
- ✅ **实时同步**：基于微信云数据库，数据实时保存到云端
- ✅ **患者列表**：查看和管理所有患者数据

### 待完善功能

- ⏳ 数据字段需要根据实际研究需求补充
- ⏳ 数据验证规则
- ⏳ 权限管理和用户系统
- ⏳ 数据统计分析图表
- ⏳ 数据备份功能

## 技术栈

- **前端**：微信小程序原生开发（WXML、WXSS、JavaScript）
- **后端**：微信云开发
  - 云数据库（NoSQL）
  - 云存储（图片文件）
  - 云函数（数据处理）
- **数据导出**：CSV 格式

## 项目结构

```
VPT-初诊数据/
├── pages/                    # 页面文件
│   ├── index/               # 首页
│   ├── patient/             # 患者管理
│   ├── preoperative/        # 术前数据
│   ├── intraoperative/      # 术中数据
│   ├── postoperative/       # 术后回访
│   └── export/              # 数据导出
├── utils/                   # 工具函数
│   └── db.js               # 数据库操作工具
├── cloudfunctions/          # 云函数
│   └── getAllData/         # 获取所有数据
├── app.js                   # 小程序入口
├── app.json                 # 小程序配置
├── app.wxss                 # 全局样式
└── README.md               # 项目说明
```

## 数据库设计

### 数据集合

1. **patients**（患者基本信息）
   - 姓名、性别、年龄
   - 联系电话、病历号
   - 初诊日期
   - 主诉、现病史、既往史
   - 备注信息

2. **preoperative**（术前检查数据）
   - 血常规（Hb、WBC、PLT）
   - 凝血功能
   - 肝肾功能
   - 心电图
   - 影像学检查
   - 其他检查项目

3. **intraoperative**（术中数据）
   - 手术日期、手术方式
   - 麻醉方式
   - 手术时长、出血量
   - 术中并发症
   - 术中照片

4. **postoperative**（术后回访）
   - 回访日期
   - 术后恢复情况
   - 并发症记录
   - 随访记录

## 快速开始

### 1. 克隆项目

```bash
git clone https://github.com/lartemac/VPT-初诊数据.git
```

### 2. 打开微信开发者工具

1. 下载并安装[微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 使用微信扫码登录
3. 导入项目，选择项目目录

### 3. 配置云开发环境

1. 在微信开发者工具中，点击"云开发"按钮
2. 开通云开发服务（创建新的云环境）
3. 在 `app.js` 中配置您的云环境 ID：

```javascript
wx.cloud.init({
  env: 'your-env-id', // 替换为您的云环境 ID
  traceUser: true,
});
```

### 4. 创建数据库集合

在云开发控制台的数据库中创建以下集合：
- `patients`
- `preoperative`
- `intraoperative`
- `postoperative`

### 5. 上传云函数

1. 右键点击 `cloudfunctions/getAllData` 目录
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

### 6. 配置 AppID

在 `project.config.json` 中配置您的小程序 AppID（如需测试可使用测试号）。

## 使用说明

### 录入数据流程

1. **新增患者**：在首页点击"新增患者"，填写患者基本信息
2. **采集数据**：从患者列表选择患者，依次录入术前、术中、术后数据
3. **上传照片**：在术中数据页面可上传术中照片
4. **导出数据**：在"导出"页面选择需要导出的数据类型

### 数据导出

1. 点击底部"导出"标签
2. 选择要导出的数据集
3. 点击"导出"按钮
4. CSV 数据会复制到剪贴板
5. 粘贴到文本编辑器保存为 `.csv` 文件
6. 使用 Excel、SPSS、R、Python 等打开分析

### 导出的 CSV 文件格式

CSV 文件使用逗号分隔，第一行为字段名，后续为数据行。日期时间格式为：`YYYY-MM-DD HH:mm:ss`。

## 注意事项

### 数据安全

- 本项目收集的是医学研究数据，请注意保护患者隐私
- 建议设置云数据库访问权限
- 不要在公开场合泄露患者信息
- 导出数据时注意数据安全

### 数据备份

建议定期导出数据进行备份，微信云数据库会根据使用量收费。

### 数据字段定制

当前提供的是基础数据字段模板，您可以根据实际研究需求修改表单字段：

1. 打开对应的页面文件（如 `pages/patient/patient.wxml`）
2. 修改或添加表单字段
3. 在对应的 JS 文件中处理数据逻辑

## 开发计划

- [ ] 完善数据字段（待用户提供具体需求）
- [ ] 添加数据验证规则
- [ ] 实现数据统计和图表展示
- [ ] 添加权限管理系统
- [ ] 优化 UI/UX 设计
- [ ] 添加数据导入功能
- [ ] 实现数据去标识化（保护隐私）

## 贡献指南

欢迎提交 Issue 和 Pull Request！

## 许可证

MIT License

## 联系方式

- 开发者：lartemac
- GitHub：https://github.com/lartemac/VPT-初诊数据

---

**注意事项**：本项目为医学研究数据收集工具，请确保符合医学伦理和患者隐私保护相关法规。
