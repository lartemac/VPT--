<!--pages/patient/patient.wxml-->
<view class="container">
  <!-- æ–°å¢/ç¼–è¾‘æ¨¡å¼ -->
  <view wx:if="{{mode === 'add' || mode === 'edit'}}">
    <view class="card">
      <text class="title">æ‚£è€…åŸºæœ¬ä¿¡æ¯</text>

      <view class="form-group">
        <text class="form-label required">æ‚£è€…å§“å</text>
        <input class="form-input" placeholder="è¯·è¾“å…¥æ‚£è€…å§“å" value="{{form.name}}" bindinput="onInputChange" data-field="name" />
      </view>

      <view class="form-group">
        <text class="form-label required">æ€§åˆ«</text>
        <radio-group class="radio-group" bindchange="onInputChange" data-field="gender">
          <label class="radio-item">
            <radio value="ç”·" checked="{{form.gender === 'ç”·'}}" color="#1890ff" />
            <text>ç”·</text>
          </label>
          <label class="radio-item">
            <radio value="å¥³" checked="{{form.gender === 'å¥³'}}" color="#1890ff" />
            <text>å¥³</text>
          </label>
        </radio-group>
      </view>

      <view class="form-group">
        <text class="form-label required">å¹´é¾„</text>
        <input class="form-input" type="number" placeholder="è¯·è¾“å…¥å¹´é¾„" value="{{form.age}}" bindinput="onInputChange" data-field="age" />
      </view>

      <view class="form-group">
        <text class="form-label">è”ç³»ç”µè¯</text>
        <input class="form-input" type="number" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯" value="{{form.phone}}" bindinput="onInputChange" data-field="phone" />
      </view>

      <view class="form-group">
        <text class="form-label">ç—…å†å·</text>
        <input class="form-input" placeholder="è¯·è¾“å…¥ç—…å†å·" value="{{form.medicalRecordNo}}" bindinput="onInputChange" data-field="medicalRecordNo" />
      </view>

      <view class="form-group">
        <text class="form-label">åˆè¯Šæ—¥æœŸ</text>
        <picker mode="date" value="{{form.firstVisitDate}}" bindchange="onDateChange" data-field="firstVisitDate">
          <view class="picker-view">{{form.firstVisitDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
        </picker>
      </view>

      <view class="form-group">
        <text class="form-label">ä¸»è¯‰</text>
        <textarea class="form-textarea" placeholder="è¯·è¾“å…¥ä¸»è¯‰" value="{{form.chiefComplaint}}" bindinput="onInputChange" data-field="chiefComplaint" maxlength="500" />
      </view>

      <view class="form-group">
        <text class="form-label">ç°ç—…å²</text>
        <textarea class="form-textarea" placeholder="è¯·è¾“å…¥ç°ç—…å²" value="{{form.presentIllness}}" bindinput="onInputChange" data-field="presentIllness" maxlength="1000" />
      </view>

      <view class="form-group">
        <text class="form-label">æ—¢å¾€å²</text>
        <textarea class="form-textarea" placeholder="è¯·è¾“å…¥æ—¢å¾€å²" value="{{form.pastHistory}}" bindinput="onInputChange" data-field="pastHistory" maxlength="1000" />
      </view>

      <view class="form-group">
        <text class="form-label">å¤‡æ³¨</text>
        <textarea class="form-textarea" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯" value="{{form.remarks}}" bindinput="onInputChange" data-field="remarks" maxlength="500" />
      </view>
    </view>

    <view class="btn-group">
      <button class="btn btn-primary" bindtap="savePatient">ä¿å­˜æ‚£è€…ä¿¡æ¯</button>
      <button class="btn btn-default" bindtap="goBack">è¿”å›</button>
    </view>
  </view>

  <!-- åˆ—è¡¨æ¨¡å¼ -->
  <view wx:if="{{mode === 'list'}}">
    <view class="search-bar">
      <input class="search-input" placeholder="æœç´¢æ‚£è€…å§“åæˆ–ç—…å†å·" value="{{searchKeyword}}" bindinput="onSearchInput" />
    </view>

    <view class="patient-list">
      <view wx:for="{{patientList}}" wx:key="_id" class="patient-item card" bindtap="viewPatient" data-id="{{item._id}}">
        <view class="patient-header">
          <text class="patient-name">{{item.name}}</text>
          <text class="patient-gender">{{item.gender}}</text>
          <text class="patient-age">{{item.age}}å²</text>
        </view>
        <view class="patient-info">
          <text class="info-item" wx:if="{{item.medicalRecordNo}}">ç—…å†å·ï¼š{{item.medicalRecordNo}}</text>
          <text class="info-item" wx:if="{{item.phone}}">ç”µè¯ï¼š{{item.phone}}</text>
        </view>
        <view class="patient-footer">
          <text class="visit-date">åˆè¯Šï¼š{{item.firstVisitDate}}</text>
          <text class="data-status">æ•°æ®å®Œæ•´åº¦ï¼š{{item.completeness || 0}}%</text>
        </view>
      </view>

      <view wx:if="{{patientList.length === 0}}" class="empty">
        <text class="empty-icon">ğŸ“‹</text>
        <text class="empty-text">æš‚æ— æ‚£è€…æ•°æ®</text>
      </view>
    </view>
  </view>
</view>
